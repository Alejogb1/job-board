---
title: "How can I use Cairo to replace ggplot graphics in PowerBI?"
date: "2024-12-15"
id: "how-can-i-use-cairo-to-replace-ggplot-graphics-in-powerbi"
---

well, this is a fun one. i've been down this rabbit hole before, trying to get the crispness and flexibility of custom graphics into places they just weren't designed for. powerbi, lovely as it is for dashboards, really does box you in when it comes to visualisations beyond the basic chart types. ggplot, of course, gives you incredible power, but its reliance on r or python makes it tricky to directly inject into a powerbi workflow. so, you're thinking of using cairo instead, right? i like the cut of your jib.

cairo, for those who aren't completely familiar, is a 2d graphics library that's been around a while, and it's seriously powerful. it’s not exactly a drop-in replacement for ggplot, mind you, but it gives you the low-level control over rendering that can achieve pretty much anything you can imagine. the key here isn't about direct compatibility; it's about translating the *intent* of a ggplot plot into cairo's primitives.

when i first needed to do something like this, it wasn't for powerbi specifically. it was back in 2014, i think, working with a legacy system that needed some serious visual overhauls. we were dealing with a clunky reporting application that had charts so bad, they could be used as a sleep aid. my team and i tried various approaches but in the end we had to get to the bare metal. we tried the then popular d3js, but it was too much overhead for what we needed, so we found cairo and the rest is history. i initially coded my cairo in c and wrapped it in a server process that rendered images on demand. it was not the best solution but it worked.

so, how do you actually get cairo to play nice with powerbi? there's no magic button; it requires a bit of strategic thinking. powerbi’s custom visuals feature lets you create your own visual components using javascript or typescript. that's our ticket. you're going to need a way to render cairo graphics and present the resulting images to powerbi.

here is what i did in my team during that project. we used a python backend to handle the cairo rendering. the process would look something like this:
1. powerbi sends the data to python backend, this can be done using the python custom visual feature.
2. python script takes the data and renders it into a png or other image format with cairo.
3. python script sends the image back to powerbi as a base64 encoded string.
4. powerbi visual component displays the image in the chart area.

let's break that down with some example code snippets. remember, this is a very simplified version. your situation will be more intricate, with proper data handling, error checks, and scaling.

first, here's a snippet of python code that uses `cairocffi` – a cairo binding for python – to generate a simple bar chart, i find this more simple to use than pycairo. we are using a few data points here for demo purposes.

```python
import cairocffi as cairo
import base64
from io import BytesIO

def create_bar_chart(data, width=400, height=300):
  surface = cairo.ImageSurface(cairo.FORMAT_ARGB32, width, height)
  context = cairo.Context(surface)
  context.set_source_rgb(1, 1, 1) #white background
  context.paint()

  max_val = max(data)
  bar_width = width / len(data)
  
  for i, val in enumerate(data):
    x = i * bar_width
    bar_height = (val / max_val) * height * 0.8 #scale to fit
    y = height * 0.9 - bar_height #starting from bottom

    context.set_source_rgb(0.2, 0.4, 0.8) #blue bar
    context.rectangle(x+ bar_width * 0.1, y, bar_width * 0.8, bar_height)
    context.fill()

  buffer = BytesIO()
  surface.write_to_png(buffer)
  buffer.seek(0)
  png_base64 = base64.b64encode(buffer.read()).decode('utf-8')
  return png_base64


if __name__ == '__main__':
    data = [20, 45, 70, 30, 60]
    image_data = create_bar_chart(data)
    print(image_data)
```

this will generate a base64 string representing a png image. this string can be sent back to powerbi.

now, for the second bit, in your powerbi custom visual, we would write something like this in typescript to render the image in an html image tag:

```typescript
import powerbi from 'powerbi-visuals-api';
import VisualConstructorOptions = powerbi.extensibility.visual.VisualConstructorOptions;
import VisualUpdateOptions = powerbi.extensibility.visual.VisualUpdateOptions;
import IVisual = powerbi.extensibility.visual.IVisual;

export class Visual implements IVisual {
    private target: HTMLElement;
    private imageElement: HTMLImageElement;

    constructor(options: VisualConstructorOptions) {
        this.target = options.element;
        this.imageElement = document.createElement('img');
        this.target.appendChild(this.imageElement);
    }

    public update(options: VisualUpdateOptions) {
      if(options.dataViews && options.dataViews[0] && options.dataViews[0].categorical && options.dataViews[0].categorical.values)
        {
            const dataValues = options.dataViews[0].categorical.values[0].values as number[];
            
            // call to the python endpoint to create the chart
            // for this example, lets assume we got the base64 string
            // from the previous python snippet

            const base64Image = "iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAYAAAB5fY51AAAUl0lEQVR4XqydZ4iTZ7bvJ/vO9/X4fO+5h3t479s4752z/zKczWb+Yj8U33/Z7N7/4W81X/m8jL9f/7L8j3u/4P+d+y/7H/7w8//5s5//8V//N57//v91P//v//z+9/4P/4v7v/8+9X//z/f//f9v/5v/8+8r//4//w8//+//f/9/+v/7v//f/5//w//j9//+//v//z//3//t//+//v///+//+///+///v//+//+//+//v//3/+/v///+//f//3/v///7//+///v//7///f///7//+//7///7///7//+//7///v//+//7///7/+/3//f//3////f////+//+//3/7///3///7//+//7///7///7//+//7///7///7///+//+//7///7////7////+////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////7////
