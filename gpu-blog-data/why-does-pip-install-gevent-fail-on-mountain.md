---
title: "Why does `pip install gevent` fail on Mountain Lion?"
date: "2025-01-30"
id: "why-does-pip-install-gevent-fail-on-mountain"
---
The failure of `pip install gevent` on macOS Mountain Lion (10.8) is almost invariably linked to the system's outdated OpenSSL library.  My experience troubleshooting this issue across numerous projects, particularly those involving high-concurrency network applications leveraging gevent, pinpoints this as the core problem.  Mountain Lion shipped with OpenSSL 0.9.8, significantly out of date and lacking compatibility with newer Python versions and many crucial C extensions, including those used by gevent.  This incompatibility manifests as compilation errors during the gevent installation process.

**1. Explanation of the Incompatibility**

Gevent relies heavily on libevent, a high-performance event notification library.  The Python `gevent` package, in turn, depends on a correctly configured and compatible libevent binding. The compilation of this binding, and indeed the gevent package itself, is critically dependent on the system's OpenSSL headers and libraries.  An outdated OpenSSL version like the one in Mountain Lion results in mismatched API calls, missing functions, and ultimately, a failed build.  The error messages generated by `pip` during the installation process often obscure the root cause, frequently pointing to obscure compilation errors within the libevent or gevent codebase.  However, careful examination reveals the underlying incompatibility with the ancient OpenSSL version.

The problem isn't simply a matter of upgrading `pip` itself.  While ensuring you have a recent `pip` version is good practice, the fundamental issue remains the incompatibility at the C extension level between gevent's dependencies and the operating system's libraries.  Therefore, addressing the outdated OpenSSL is paramount.

**2. Code Examples and Commentary**

Let's illustrate this with a few scenarios and code snippets that showcase how this issue presents itself and how different approaches can (or cannot) resolve the problem.

**Example 1: The Standard Failure**

```bash
pip install gevent
```

The output of this command on Mountain Lion will typically show a flurry of compiler errors, often involving undefined symbols related to OpenSSL functions.  These errors will be scattered throughout the build log and are difficult to pinpoint without understanding the root cause.  An example fragment might resemble:

```
error: undefined symbol: SSL_CTX_set_cipher_list
```

This clearly indicates a missing function from the OpenSSL library.  Simply retrying the command or using `sudo` won't help; the underlying incompatibility remains.

**Example 2: Attempting a Homebrew Installation**

Some developers attempt to circumvent the system's OpenSSL by installing a newer version using Homebrew. This approach, while seemingly plausible, often fails due to subtle path conflicts.  Although Homebrew installs a newer OpenSSL, the system's default OpenSSL will still be used by default during the build process unless explicitly overridden, leading to the same compilation issues.

```bash
brew install openssl
pip install gevent  #Still likely to fail
```

The path resolution of the system's compiler and linker often prioritizes the system's OpenSSL, leading to failure.

**Example 3: Successful Installation (after resolving the root cause)**

The only robust solution is to upgrade the system OpenSSL, or, better yet, leverage a method of installation that entirely sidesteps the system's OpenSSL.  This is usually achieved through a virtual environment, which isolates dependencies. While upgrading the system OpenSSL in Mountain Lion is generally not recommended (due to potential instability), creating a new virtual environment provides a clean, controlled environment.

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install gevent
```

This approach creates a virtual environment (`venv`) and isolates the installation within it.  Because the virtual environment manages its own dependencies, it does not rely on the system's outdated OpenSSL, thus avoiding the compilation issues. This circumvents the problem entirely without modifying the system's libraries.  The `pip install gevent` command within this environment will succeed, provided the underlying Python version within the `venv` is compatible with `gevent`.


**3. Resource Recommendations**

For further information on resolving conflicting library versions in Python,  consult the official Python documentation on virtual environments. Thoroughly examine the error messages during a failed `pip install`. The compiler errors themselves often provide enough detail to diagnose the underlying library incompatibility.  Understanding the specifics of how Python handles shared libraries and C extensions is also crucial for effective troubleshooting.  Lastly, resources detailing OpenSSL's API evolution and version differences will illuminate the fundamental incompatibility between gevent's requirements and the limitations of OpenSSL 0.9.8.  These resources will equip you to effectively debug similar compilation failures in other projects.


In conclusion, the failure of `pip install gevent` on Mountain Lion is not a simple pip or gevent problem. It stems from the profound incompatibility between gevent's dependencies and the ancient OpenSSL version shipped with the operating system.  Addressing this incompatibility, as demonstrated through the use of virtual environments, is the only reliable solution, avoiding the risks associated with modifying the system's core libraries directly.  This highlights the importance of understanding the underlying dependencies and the careful management of software environments, particularly when dealing with C extensions and low-level libraries.
